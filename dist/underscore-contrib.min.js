// underscore-contrib v0.1.1
// =========================

// > https://github.com/documentcloud/underscore-contrib
// > (c) 2013 Michael Fogus, DocumentCloud and Investigative Reporters & Editors
// > underscore-contrib may be freely distributed under the MIT license.

(function(n){var r=n._||require("underscore"),t=Array.prototype.slice,e=Array.prototype.concat,u=function(n){return null!=n};r.mixin({cat:function(){return r.reduce(arguments,function(n,u){return r.isArguments(u)?e.call(n,t.call(u)):e.call(n,u)},[])},cons:function(n,t){return r.cat([n],t)},partition:function(n,t,e){var u=function(n){if(null==n)return[];var i=r.take(n,t);return t===r.size(i)?r.cons(i,u(r.drop(n,t))):e?[r.take(r.cat(i,e),t)]:[]};return u(n)},partitionAll:function(n,t,e){e=null!=e?e:t;var u=function(n,t,e){return r.isEmpty(n)?[]:r.cons(r.take(n,t),u(r.drop(n,e),t,e))};return u(n,t,e)},mapcat:function(n,t){return r.cat.apply(null,r.map(n,t))},interpose:function(n,e){if(!r.isArray(n))throw new TypeError;var u=r.size(n);return 0===u?n:1===u?n:t.call(r.mapcat(n,function(n){return r.cons(n,[e])}),0,-1)},weave:function(){return r.some(arguments)?r.filter(r.flatten(r.zip.apply(null,arguments),!0),function(n){return null!=n}):[]},interleave:r.weave,repeat:function(n,t){return r.times(n,function(){return t})},cycle:function(n,t){return r.flatten(r.times(n,function(){return t}),!0)},splitAt:function(n,t){return[r.take(n,t),r.drop(n,t)]},iterateUntil:function(n,r,t){for(var e=[],u=n(t);r(u);)e.push(u),u=n(u);return e},takeSkipping:function(n,t){var e=[],u=r.size(n);if(0>=t)return[];if(1===t)return n;for(var i=0;u>i;i+=t)e.push(n[i]);return e},reductions:function(n,t,e){var u=[],i=e;return r.each(n,function(r,e){i=t(i,n[e]),u.push(i)}),u},keepIndexed:function(n,t){return r.filter(r.map(r.range(r.size(n)),function(r){return t(r,n[r])}),u)}})})(this),function(n){var r=n._||require("underscore"),t=Array.prototype.slice,e=Array.prototype.concat,u=function(n){return null!=n},i=function(n){return n!==!1&&u(n)},o=function(n){return r.isArray(n)||r.isArguments(n)};r.mixin({second:function(n,r,e){return null==n?void 0:null==r||e?n[1]:t.call(n,1,r)},nth:function(n,r){if(0>r||r>n.length-1)throw Error("Attempting to index outside the bounds of the array.");return n[r]},takeWhile:function(n,t){if(!o(n))throw new TypeError;for(var e=r.size(n),u=0;e>u&&i(t(n[u]));u++);return r.take(n,u)},dropWhile:function(n,t){if(!o(n))throw new TypeError;for(var e=r.size(n),u=0;e>u&&i(t(n[u]));u++);return r.drop(n,u)},splitWith:function(n,t){return[r.takeWhile(t,n),r.dropWhile(t,n)]},partitionBy:function(n,t){if(r.isEmpty(n)||!u(n))return[];var i=r.first(n),o=t(i),a=e.call([i],r.takeWhile(r.rest(n),function(n){return r.isEqual(o,t(n))}));return e.call([a],r.partitionBy(r.drop(n,r.size(a)),t))},best:function(n,t){return r.reduce(n,function(n,r){return t(n,r)?n:r})},keep:function(n,t){if(!o(n))throw new TypeError("expected an array as the first argument");return r.filter(r.map(n,function(n){return t(n)}),u)}})}(this),function(n){function r(n,r,t,o){var a=[];(function c(n,l,f){if(!r||r.call(o,n,l,f)!==u){if(e.isObject(n)||e.isArray(n)){if(a.indexOf(n)>=0)throw new TypeError(i);a.push(n),e.each(e.isElement(n)?n.children:n,c,o)}t&&t.call(o,n,l,f)}})(n)}function t(n,r,t){var i=[];return e.walk.preorder(n,function(n,e){return e!==r||(i[i.length]=n,t)?void 0:u}),i}var e=n._||require("underscore"),u={},i="Not a tree: same object found in two different branches";e.walk=r,e.extend(r,{postorder:function(n,t,e){r(n,null,t,e)},preorder:function(n,t,e){r(n,t,null,e)},map:function(n,r,t,e){var u=[];return r.call(null,n,function(n,r,i){u[u.length]=t.call(e,n,r,i)}),u},pluck:function(n,r){return t(n,r,!1)},pluckRec:function(n,r){return t(n,r,!0)}}),e.walk.collect=e.walk.map}(this),function(n){var r=n._||require("underscore"),t=function(){function n(n){if(1!==n)throw new RangeError("Only a single argument may be accepted.")}function r(t,e,u,i,o,a){return 1==a?i.unshift(o):i.push(o),i.length==u?t.apply(e,i):function(){return n(arguments.length),r(t,e,u,i.slice(0),arguments[0],a)}}return function(t,e){var u=this;return function(){return n(arguments.length),r(t,u,t.length,[],arguments[0],e)}}}();r.mixin({fix:function(n){var t=r.rest(arguments),e=function(){for(var e=0,u=0;t.length>u&&arguments.length>e;u++)t[u]===r&&(t[u]=arguments[e++]);return n.apply(null,t)};return e._original=n,e},unary:function(n){return function(r){return n.call(this,r)}},binary:function(n){return function(r,t){return n.call(this,r,t)}},ternary:function(n){return function(r,t,e){return n.call(this,r,t,e)}},quaternary:function(n){return function(r,t,e,u){return n.call(this,r,t,e,u)}},curry:t,rCurry:function(n){return t.call(this,n,!0)}}),r.arity=function(){var n={};return function r(t,e){if(null==n[t]){for(var u=Array(t),i=0;t>i;++i)u[i]="__"+i;var o=u.join(),a="return function ("+o+") { return fun.apply(this, arguments); };";n[t]=Function(["fun"],a)}return null==e?function(n){return r(t,n)}:n[t](e)}}()}(this),function(n){function r(n,r){return t.arity(n.length,function(){return n.apply(this,a.call(arguments,r))})}var t=n._||require("underscore"),e=function(n){return null!=n},u=function(n){return n!==!1&&e(n)},i=[].reverse,o=[].slice,a=[].map,c=function(n){return function(r,t){return 1===arguments.length?function(t){return n(r,t)}:n(r,t)}};t.mixin({always:function(n){return function(){return n}},pipeline:function(){var n=t.isArray(arguments[0])?arguments[0]:arguments;return function(r){return t.reduce(n,function(n,r){return r(n)},r)}},conjoin:function(){var n=arguments;return function(r){return t.every(r,function(r){return t.every(n,function(n){return n(r)})})}},disjoin:function(){var n=arguments;return function(r){return t.some(r,function(r){return t.some(n,function(n){return n(r)})})}},comparator:function(n){return function(r,t){return u(n(r,t))?-1:u(n(t,r))?1:0}},complement:function(n){return function(){return!n.apply(null,arguments)}},splat:function(n){return function(r){return n.apply(null,r)}},unsplat:function(n){var r=n.length;return 1>r?n:1===r?function(){return n.call(this,o.call(arguments,0))}:function(){var t=arguments.length,e=o.call(arguments,0,r-1),u=Math.max(r-t-1,0),i=Array(u),a=o.call(arguments,n.length-1);return n.apply(this,e.concat(i).concat([a]))}},unsplatl:function(n){var r=n.length;return 1>r?n:1===r?function(){return n.call(this,o.call(arguments,0))}:function(){var t=arguments.length,e=o.call(arguments,Math.max(t-r+1,0)),u=o.call(arguments,0,Math.max(t-r+1,0));return n.apply(this,[u].concat(e))}},mapArgs:c(r),juxt:function(){var n=arguments;return function(){var r=arguments;return t.map(n,function(n){return n.apply(null,r)})}},fnull:function(n){var r=t.rest(arguments);return function(){for(var u=t.toArray(arguments),i=t.size(r),o=0;i>o;o++)e(u[o])||(u[o]=r[o]);return n.apply(null,u)}},flip2:function(n){return function(){var r=arguments[0];return arguments[0]=arguments[1],arguments[1]=r,n.apply(null,arguments)}},flip:function(n){return function(){var r=i.call(arguments);return n.apply(null,r)}},k:t.always,t:t.pipeline}),t.unsplatr=t.unsplat,t.mapArgsWith=c(t.flip(r))}(this),function(n){function r(n){return function(r){return n.call(this,r)}}function t(n,r,t){var e,u;for(e=t!==void 0?t:n(),u=n();null!=u;)e=r.call(u,e,u),u=n();return e}function e(n,r){var t=x;return function(){return t===x?t=n:null!=t?t=r.call(t,t):t}}function u(n,r){var t,e,u=n;return function(){return null!=u?(t=r.call(u,u),e=t[1],u=null!=e?t[0]:void 0,e):void 0}}function i(n,r,t){var e=t;return function(){return element=n(),null==element?element:e=e===void 0?element:r.call(element,e,element)}}function o(n,r,t){var e,u=t;return function(){return element=n(),null==element?element:u===void 0?u=element:(e=r.call(element,u,element),u=e[0],e[1])}}function a(n,r){return function(){var t;return t=n(),null!=t?r.call(t,t):void 0}}function c(n,r){return function(){var t;for(t=n();null!=t;){if(r.call(t,t))return t;t=n()}return void 0}}function l(n,r){return c(n,function(n){return!r(n)})}function f(n,r){return c(n,r)()}function s(n,r,t){for(var e=0;r-->0;)n();return null!=t?function(){return t>=++e?n():void 0}:n}function p(n,r){return s(n,null==r?1:r)}function m(n,r){return s(n,0,null==r?1:r)}function v(n){var r=0;return function(){return n[r++]}}function h(n){var r,t,e;return r=0,e=[],t=function(){var u,i;return u=n[r++],u instanceof Array?(e.push({array:n,index:r}),n=u,r=0,t()):u===void 0?e.length>0?(i=e.pop(),n=i.array,r=i.index,t()):void 0:u}}function g(n){return function(){return n}}function y(n,r,t){return function(){var e;return n>r?void 0:(e=n,n+=t,e)}}function d(n,r,t){return function(){var e;return r>n?void 0:(e=n,n-=t,e)}}function A(n,r,t){return null==n?y(1,1/0,1):null==r?y(n,1/0,1):null==t?r>=n?y(n,r,1):d(n,r,1):t>0?y(n,r,t):0>t?d(n,r,Math.abs(t)):k(n)}var w=n._||require("underscore"),x={},q=r(A);w.iterators={accumulate:i,accumulateWithReturn:o,foldl:t,reduce:t,unfold:e,unfoldWithReturn:u,map:a,select:c,reject:l,filter:c,find:f,slice:s,drop:p,take:m,List:v,Tree:h,constant:g,K:g,numbers:q,range:A}}(this),function(n){var r=n._||require("underscore");r.mixin({isInstanceOf:function(n,r){return n instanceof r},isAssociative:function(n){return r.isArray(n)||r.isObject(n)||r.isArguments(n)},isIndexed:function(n){return r.isArray(n)||r.isString(n)||r.isArguments(n)},isSequential:function(n){return r.isArray(n)||r.isArguments(n)},isZero:function(n){return 0===n},isEven:function(n){return r.isFinite(n)&&0===(1&n)},isOdd:function(n){return r.isFinite(n)&&!r.isEven(n)},isPositive:function(n){return n>0},isNegative:function(n){return 0>n},isValidDate:function(n){return r.isDate(n)&&!r.isNaN(n.getTime())},isNumeric:function(n){return!isNaN(parseFloat(n))&&isFinite(n)},isInteger:function(n){return r.isNumeric(n)&&0===n%1},isFloat:function(n){return r.isNumeric(n)&&!r.isInteger(n)},isIncreasing:function(){var n=r.size(arguments);if(1===n)return!0;if(2===n)return arguments[0]<arguments[1];for(var t=1;n>t;t++)if(arguments[t-1]>=arguments[t])return!1;return!0},isDecreasing:function(){var n=r.size(arguments);if(1===n)return!0;if(2===n)return arguments[0]>arguments[1];for(var t=1;n>t;t++)if(arguments[t-1]<=arguments[t])return!1;return!0}})}(this),function(n){var r=n._||require("underscore"),t=(Array.prototype.slice,Array.prototype.concat),e=function(n){return null!=n},u=function(n){return n!==!1&&e(n)},i=function(n){return r.isArray(n)||r.isObject(n)},o=function(n){return function(r){return function(t){return n(t,r)}}};r.mixin({merge:function(){var n=r.some(arguments)?{}:null;return u(n)&&r.extend.apply(null,t.call([n],r.toArray(arguments))),n},renameKeys:function(n,u){return r.reduce(u,function(r,t,u){return e(n[u])?(r[t]=n[u],r):r},r.omit.apply(null,t.call([n],r.keys(u))))},snapshot:function(n){if(null==n||"object"!=typeof n)return n;var t=new n.constructor;for(var e in n)t[e]=r.snapshot(n[e]);return t},updatePath:function(n,t,u){if(!i(n))throw new TypeError("Attempted to update a non-associative object.");if(!e(u))return t(n);var o=r.isArray(u),a=o?u:[u],c=o?r.snapshot(n):r.clone(n),l=r.last(a),f=c;return r.each(r.initial(a),function(n){f=f[n]}),f[l]=t(f[l]),c},setPath:function(n,t,u){if(!e(u))throw new TypeError("Attempted to set a property at a null path.");return r.updatePath(n,function(){return t},u)},frequencies:o(r.countBy)(r.identity)})}(this),function(n){var r=n._||require("underscore"),t=Array.prototype.concat;r.mixin({accessor:function(n){return function(r){return r&&r[n]}},dictionary:function(n){return function(r){return n&&r&&n[r]}},selectKeys:function(n,e){return r.pick.apply(null,t.call([n],e))},kv:function(n,t){return r.has(n,t)?[t,n[t]]:void 0},getPath:function e(n,r){return void 0===n?void 0:0===r.length?n:null===n?void 0:e(n[[].shift.call(r)],r)},hasPath:function u(n,r){var t=r.length;return null==n&&t>0?!1:r[0]in n?1===t?!0:u(n[[].shift.call(r)],r):!1}})}(this),function(n){var r=n._||require("underscore");r.mixin({exists:function(n){return null!=n},truthy:function(n){return n!==!1&&r.exists(n)},falsey:function(n){return!r.truthy(n)},not:function(n){return!n}})}(this),function(n){var r=n._||require("underscore");r.mixin({explode:function(n){return n.split("")},implode:function(n){return n.join("")}})}(this),function(n){var r=n._||require("underscore");r.mixin({done:function(n){var t=r(n);return t.stopTrampoline=!0,t},trampoline:function(n){for(var t=n.apply(n,r.rest(arguments));r.isFunction(t)&&(t=t(),!(t instanceof r&&t.stopTrampoline)););return t.value()}})}(this);