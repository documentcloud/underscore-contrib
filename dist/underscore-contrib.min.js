// underscore-contrib v0.2.2
// =========================

// > https://github.com/documentcloud/underscore-contrib
// > (c) 2013 Michael Fogus, DocumentCloud and Investigative Reporters & Editors
// > underscore-contrib may be freely distributed under the MIT license.

(function(n){var r=n._||require("underscore"),t=Array.prototype.slice,u=Array.prototype.concat,e=function(n){return null!=n};r.mixin({cat:function(){return r.reduce(arguments,function(n,e){return r.isArguments(e)?u.call(n,t.call(e)):u.call(n,e)},[])},cons:function(n,t){return r.cat([n],t)},partition:function(n,t,u){var e=function(n){if(null==n)return[];var i=r.take(n,t);return t===r.size(i)?r.cons(i,e(r.drop(n,t))):u?[r.take(r.cat(i,u),t)]:[]};return e(n)},partitionAll:function(n,t,u){u=null!=u?u:t;var e=function(n,t,u){return r.isEmpty(n)?[]:r.cons(r.take(n,t),e(r.drop(n,u),t,u))};return e(n,t,u)},mapcat:function(n,t){return r.cat.apply(null,r.map(n,t))},interpose:function(n,u){if(!r.isArray(n))throw new TypeError;var e=r.size(n);return 0===e?n:1===e?n:t.call(r.mapcat(n,function(n){return r.cons(n,[u])}),0,-1)},weave:function(){return r.some(arguments)?1==arguments.length?arguments[0]:r.filter(r.flatten(r.zip.apply(null,arguments),!0),function(n){return null!=n}):[]},interleave:r.weave,repeat:function(n,t){return r.times(n,function(){return t})},cycle:function(n,t){return r.flatten(r.times(n,function(){return t}),!0)},splitAt:function(n,t){return[r.take(n,t),r.drop(n,t)]},iterateUntil:function(n,r,t){for(var u=[],e=n(t);r(e);)u.push(e),e=n(e);return u},takeSkipping:function(n,t){var u=[],e=r.size(n);if(0>=t)return[];if(1===t)return n;for(var i=0;e>i;i+=t)u.push(n[i]);return u},reductions:function(n,t,u){var e=[],i=u;return r.each(n,function(r,u){i=t(i,n[u]),e.push(i)}),e},keepIndexed:function(n,t){return r.filter(r.map(r.range(r.size(n)),function(r){return t(r,n[r])}),e)},reverseOrder:function(n){if("string"==typeof n)throw new TypeError("Strings cannot be reversed by _.reverseOrder");return t.call(n).reverse()}})})(this),function(n){var r=n._||require("underscore"),t=Array.prototype.slice,u=Array.prototype.concat,e=function(n){return null!=n},i=function(n){return n!==!1&&e(n)},o=function(n){return r.isArray(n)||r.isArguments(n)};r.mixin({second:function(n,r,u){return null==n?void 0:null==r||u?n[1]:t.call(n,1,r)},third:function(n,r,u){return null==n?void 0:null==r||u?n[2]:t.call(n,2,r)},nth:function(n,r,t){return null==r||t?void 0:n[r]},takeWhile:function(n,t){if(!o(n))throw new TypeError;for(var u=r.size(n),e=0;u>e&&i(t(n[e]));e++);return r.take(n,e)},dropWhile:function(n,t){if(!o(n))throw new TypeError;for(var u=r.size(n),e=0;u>e&&i(t(n[e]));e++);return r.drop(n,e)},splitWith:function(n,t){return[r.takeWhile(n,t),r.dropWhile(n,t)]},partitionBy:function(n,t){if(r.isEmpty(n)||!e(n))return[];var i=r.first(n),o=t(i),c=u.call([i],r.takeWhile(r.rest(n),function(n){return r.isEqual(o,t(n))}));return u.call([c],r.partitionBy(r.drop(n,r.size(c)),t))},best:function(n,t){return r.reduce(n,function(n,r){return t(n,r)?n:r})},keep:function(n,t){if(!o(n))throw new TypeError("expected an array as the first argument");return r.filter(r.map(n,function(n){return t(n)}),e)}})}(this),function(n){function r(n){return e.isElement(n)?n.children:n}function t(n,r,t,u,a,f){var l=[];return function s(n,p,v){if(e.isObject(n)){if(l.indexOf(n)>=0)throw new TypeError(c);l.push(n)}if(t){var m=t.call(a,n,p,v);if(m===o)return o;if(m===i)return}var h,g=r(n);if(e.isObject(g)&&!e.isEmpty(g)){f&&(h=e.isArray(n)?[]:{});var y=e.any(g,function(r,t){var u=s(r,t,n);return u===o?!0:(h&&(h[t]=u),void 0)});if(y)return o}return u?u.call(a,n,p,v,h):void 0}(n)}function u(n,r,t){var u=[];return this.preorder(n,function(n,o){return t||o!=r?(e.has(n,r)&&(u[u.length]=n[r]),void 0):i}),u}var e=n._||require("underscore"),i={},o={},c="Not a tree: same object found in two different branches",a={find:function(n,r,t){var u;return this.preorder(n,function(n,e,i){return r.call(t,n,e,i)?(u=n,o):void 0},t),u},filter:function(n,r,t,u){var e=[];return null==n?e:(r(n,function(n,r,i){t.call(u,n,r,i)&&e.push(n)},null,this._traversalStrategy),e)},reject:function(n,r,t,u){return this.filter(n,r,function(n,r,e){return!t.call(u,n,r,e)})},map:function(n,r,t,u){var e=[];return r(n,function(n,r,i){e[e.length]=t.call(u,n,r,i)},null,this._traversalStrategy),e},pluck:function(n,r){return u.call(this,n,r,!1)},pluckRec:function(n,r){return u.call(this,n,r,!0)},postorder:function(n,r,u,e){e=e||this._traversalStrategy,t(n,e,null,r,u)},preorder:function(n,r,u,e){e=e||this._traversalStrategy,t(n,e,r,null,u)},reduce:function(n,r,u,e){var i=function(n,t,e,i){return r(i||u,n,t,e)};return t(n,this._traversalStrategy,null,i,e,!0)}};a.collect=a.map,a.detect=a.find,a.select=a.filter,e.walk=function(n){var t=e.clone(a);return e.bindAll.apply(null,[t].concat(e.keys(t))),t._traversalStrategy=n||r,t},e.extend(e.walk,e.walk())}(this),function(n){function r(n){return function(){if(1===arguments.length)return n.apply(this,arguments);throw new RangeError("Only a single argument may be accepted.")}}var t=n._||require("underscore"),u=function(){function n(t,u,e,i,o,c){return c===!0?i.unshift(o):i.push(o),i.length==e?t.apply(u,i):r(function(){return n(t,u,e,i.slice(0),arguments[0],c)})}return function(t,u){var e=this;return r(function(){return n(t,e,t.length,[],arguments[0],u)})}}(),e=function(){var n=[];return function(r){if("function"!=typeof r)throw Error("Argument 1 must be a function.");var t=r.length;return void 0===n[t]&&(n[t]=function(n){return function(){if(arguments.length!==t)throw new RangeError(t+" arguments must be applied.");return n.apply(this,arguments)}}),n[t](r)}}();t.mixin({fix:function(n){var r=t.rest(arguments),u=function(){for(var u=r.slice(),e=0,i=0;(u.length||arguments.length>e)>i;i++)u[i]===t&&(u[i]=arguments[e++]);return n.apply(null,u)};return u._original=n,u},unary:function(n){return function(r){return n.call(this,r)}},binary:function(n){return function(r,t){return n.call(this,r,t)}},ternary:function(n){return function(r,t,u){return n.call(this,r,t,u)}},quaternary:function(n){return function(r,t,u,e){return n.call(this,r,t,u,e)}},curry:u,rCurry:function(n){return u.call(this,n,!0)},curry2:function(n){return r(function(t){return r(function(r){return n.call(this,t,r)})})},curry3:function(n){return r(function(t){return r(function(u){return r(function(r){return n.call(this,t,u,r)})})})},rcurry2:function(n){return r(function(t){return r(function(r){return n.call(this,r,t)})})},rcurry3:function(n){return r(function(t){return r(function(u){return r(function(r){return n.call(this,r,u,t)})})})},enforce:e}),t.arity=function(){var n={};return function r(t,u){if(null==n[t]){for(var e=Array(t),i=0;t>i;++i)e[i]="__"+i;var o=e.join(),c="return function ("+o+") { return fun.apply(this, arguments); };";n[t]=Function(["fun"],c)}return null==u?function(n){return r(t,n)}:n[t](u)}}()}(this),function(n){function r(n,r){return t.arity(n.length,function(){return n.apply(this,c.call(arguments,r))})}var t=n._||require("underscore"),u=function(n){return null!=n},e=function(n){return n!==!1&&u(n)},i=[].reverse,o=[].slice,c=[].map,a=function(n){return function(r,t){return 1===arguments.length?function(t){return n(r,t)}:n(r,t)}};t.mixin({always:function(n){return function(){return n}},pipeline:function(){var n=t.isArray(arguments[0])?arguments[0]:arguments;return function(r){return t.reduce(n,function(n,r){return r(n)},r)}},conjoin:function(){var n=arguments;return function(r){return t.every(r,function(r){return t.every(n,function(n){return n(r)})})}},disjoin:function(){var n=arguments;return function(r){return t.some(r,function(r){return t.some(n,function(n){return n(r)})})}},comparator:function(n){return function(r,t){return e(n(r,t))?-1:e(n(t,r))?1:0}},complement:function(n){return function(){return!n.apply(null,arguments)}},splat:function(n){return function(r){return n.apply(null,r)}},unsplat:function(n){var r=n.length;return 1>r?n:1===r?function(){return n.call(this,o.call(arguments,0))}:function(){var t=arguments.length,u=o.call(arguments,0,r-1),e=Math.max(r-t-1,0),i=Array(e),c=o.call(arguments,n.length-1);return n.apply(this,u.concat(i).concat([c]))}},unsplatl:function(n){var r=n.length;return 1>r?n:1===r?function(){return n.call(this,o.call(arguments,0))}:function(){var t=arguments.length,u=o.call(arguments,Math.max(t-r+1,0)),e=o.call(arguments,0,Math.max(t-r+1,0));return n.apply(this,[e].concat(u))}},mapArgs:a(r),juxt:function(){var n=arguments;return function(){var r=arguments;return t.map(n,function(n){return n.apply(null,r)})}},fnull:function(n){var r=t.rest(arguments);return function(){for(var e=t.toArray(arguments),i=t.size(r),o=0;i>o;o++)u(e[o])||(e[o]=r[o]);return n.apply(null,e)}},flip2:function(n){return function(){var r=o.call(arguments);return r[0]=arguments[1],r[1]=arguments[0],n.apply(null,r)}},flip:function(n){return function(){var r=i.call(arguments);return n.apply(null,r)}},functionalize:function(n){return function(r){return n.apply(r,t.rest(arguments))}},methodize:function(n){return function(){return n.apply(null,t.cons(this,arguments))}},k:t.always,t:t.pipeline}),t.unsplatr=t.unsplat,t.mapArgsWith=a(t.flip(r)),t.bound=function(n,r){var u=n[r];if(!t.isFunction(u))throw new TypeError("Expected property to be a function");return t.bind(u,n)}}(this),function(n){var r=n._||require("underscore"),t=Array.prototype.slice;r.mixin({attempt:function(n,u){if(null==n)return void 0;var e=n[u],i=t.call(arguments,2);return r.isFunction(e)?e.apply(n,i):void 0}})}(this),function(n){function r(n){return function(r){return n.call(this,r)}}function t(n,r,t){var u,e;for(u=t!==void 0?t:n(),e=n();null!=e;)u=r.call(e,u,e),e=n();return u}function u(n,r){var t=x;return function(){return t===x?t=n:null!=t&&(t=r.call(t,t)),t}}function e(n,r){var t,u,e=n;return function(){return null!=e?(t=r.call(e,e),u=t[1],e=null!=u?t[0]:void 0,u):void 0}}function i(n,r,t){var u=t;return function(){var t=n();return null==t?t:u=u===void 0?t:r.call(t,u,t)}}function o(n,r,t){var u,e,i=t;return function(){return e=n(),null==e?e:i===void 0?i=e:(u=r.call(e,i,e),i=u[0],u[1])}}function c(n,r){return function(){var t;return t=n(),null!=t?r.call(t,t):void 0}}function a(n,r){var t=null;return function(){var u,e;if(null==t){if(e=n(),null==e)return t=null,void 0;t=r.call(e,e)}for(;null==u;)if(u=t(),null==u){if(e=n(),null==e)return t=null,void 0;t=r.call(e,e)}return u}}function f(n,r){return function(){var t;for(t=n();null!=t;){if(r.call(t,t))return t;t=n()}return void 0}}function l(n,r){return f(n,function(n){return!r(n)})}function s(n,r){return f(n,r)()}function p(n,r,t){for(var u=0;r-->0;)n();return null!=t?function(){return t>=++u?n():void 0}:n}function v(n,r){return p(n,null==r?1:r)}function m(n,r){return p(n,0,null==r?1:r)}function h(n){var r=0;return function(){return n[r++]}}function g(n){var r,t,u;return r=0,u=[],t=function(){var e,i;return e=n[r++],e instanceof Array?(u.push({array:n,index:r}),n=e,r=0,t()):e===void 0?u.length>0?(i=u.pop(),n=i.array,r=i.index,t()):void 0:e}}function y(n){return function(){return n}}function d(n,r,t){return function(){var u;return n>r?void 0:(u=n,n+=t,u)}}function w(n,r,t){return function(){var u;return r>n?void 0:(u=n,n-=t,u)}}function A(n,r,t){return null==n?d(1,1/0,1):null==r?d(n,1/0,1):null==t?r>=n?d(n,r,1):w(n,r,1):t>0?d(n,r,t):0>t?w(n,r,Math.abs(t)):k(n)}var b=n._||require("underscore"),x={},_=r(A);b.iterators={accumulate:i,accumulateWithReturn:o,foldl:t,reduce:t,unfold:u,unfoldWithReturn:e,map:c,mapcat:a,select:f,reject:l,filter:f,find:s,slice:p,drop:v,take:m,List:h,Tree:g,constant:y,K:y,numbers:_,range:A}}(this,void 0),function(n){var r=n._||require("underscore");r.mixin({isInstanceOf:function(n,r){return n instanceof r},isAssociative:function(n){return r.isArray(n)||r.isObject(n)||r.isArguments(n)},isIndexed:function(n){return r.isArray(n)||r.isString(n)||r.isArguments(n)},isSequential:function(n){return r.isArray(n)||r.isArguments(n)},isPlainObject:function(t){return r.isObject(t)&&t.constructor===n.Object},isZero:function(n){return 0===n},isEven:function(n){return r.isFinite(n)&&0===(1&n)},isOdd:function(n){return r.isFinite(n)&&!r.isEven(n)},isPositive:function(n){return n>0},isNegative:function(n){return 0>n},isValidDate:function(n){return r.isDate(n)&&!r.isNaN(n.getTime())},isNumeric:function(n){return!isNaN(parseFloat(n))&&isFinite(n)},isInteger:function(n){return r.isNumeric(n)&&0===n%1},isFloat:function(n){return r.isNumeric(n)&&!r.isInteger(n)},isJSON:function(n){try{JSON.parse(n)}catch(r){return!1}return!0},isIncreasing:function(){var n=r.size(arguments);if(1===n)return!0;if(2===n)return arguments[0]<arguments[1];for(var t=1;n>t;t++)if(arguments[t-1]>=arguments[t])return!1;return!0},isDecreasing:function(){var n=r.size(arguments);if(1===n)return!0;if(2===n)return arguments[0]>arguments[1];for(var t=1;n>t;t++)if(arguments[t-1]<=arguments[t])return!1;return!0}})}(this),function(n){var r=n._||require("underscore"),t=(Array.prototype.slice,Array.prototype.concat),u=function(n){return null!=n},e=function(n){return n!==!1&&u(n)},i=function(n){return r.isArray(n)||r.isObject(n)},o=function(n){return function(r){return function(t){return n(t,r)}}};r.mixin({merge:function(){var n=r.some(arguments)?{}:null;return e(n)&&r.extend.apply(null,t.call([n],r.toArray(arguments))),n},renameKeys:function(n,e){return r.reduce(e,function(r,t,e){return u(n[e])?(r[t]=n[e],r):r},r.omit.apply(null,t.call([n],r.keys(e))))},snapshot:function(n){if(null==n||"object"!=typeof n)return n;var t=new n.constructor;for(var u in n)n.hasOwnProperty(u)&&(t[u]=r.snapshot(n[u]));return t},updatePath:function(n,t,e,o){if(!i(n))throw new TypeError("Attempted to update a non-associative object.");if(!u(e))return t(n);var c=r.isArray(e),a=c?e:[e],f=c?r.snapshot(n):r.clone(n),l=r.last(a),s=f;return r.each(r.initial(a),function(n){o&&!r.has(s,n)&&(s[n]=r.clone(o)),s=s[n]}),s[l]=t(s[l]),f},setPath:function(n,t,e,i){if(!u(e))throw new TypeError("Attempted to set a property at a null path.");return r.updatePath(n,function(){return t},e,i)},frequencies:o(r.countBy)(r.identity)})}(this),function(n){var r=n._||require("underscore"),t=Array.prototype.concat,u=Array.prototype;u.slice,r.mixin({accessor:function(n){return function(r){return r&&r[n]}},dictionary:function(n){return function(r){return n&&r&&n[r]}},selectKeys:function(n,u){return r.pick.apply(null,t.call([n],u))},kv:function(n,t){return r.has(n,t)?[t,n[t]]:void 0},getPath:function e(n,t){return"string"==typeof t&&(t=t.split(".")),void 0===n?void 0:0===t.length?n:null===n?void 0:e(n[r.first(t)],r.rest(t))},hasPath:function i(n,t){"string"==typeof t&&(t=t.split("."));var u=t.length;return null==n&&u>0?!1:t[0]in n?1===u?!0:i(n[r.first(t)],r.rest(t)):!1},pickWhen:function(n,t){var u={};return r.each(n,function(r,e){t(n[e])&&(u[e]=n[e])}),u},omitWhen:function(n,t){return r.pickWhen(n,function(n){return!t(n)})}})}(this),function(n){var r=n._||require("underscore");r.mixin({exists:function(n){return null!=n},truthy:function(n){return n!==!1&&r.exists(n)},falsey:function(n){return!r.truthy(n)},not:function(n){return!n},firstExisting:function(){for(var n=0;arguments.length>n;n++)if(null!=arguments[n])return arguments[n]}})}(this),function(n){function r(n){return function(){return E.reduce(arguments,n)}}function t(n){return function(){for(var r,t=0;arguments.length-1>t;t++)if(r=n(arguments[t],arguments[t+1]),r===!1)return r;return r}}function u(n){return function(){return!n.apply(this,arguments)}}function e(n,r){return n+r}function i(n,r){return n-r}function o(n,r){return n*r}function c(n,r){return n/r}function a(n,r){return n%r}function f(n){return++n}function l(n){return--n}function s(n){return-n}function p(n,r){return n&r}function v(n,r){return n|r}function m(n,r){return n^r}function h(n,r){return n<<r}function g(n,r){return n>>r}function y(n,r){return n>>>r}function d(n){return~n}function w(n,r){return n==r}function A(n,r){return n===r}function b(n){return!n}function x(n,r){return n>r}function k(n,r){return r>n}function _(n,r){return n>=r}function q(n,r){return r>=n}var E=n._||require("underscore");E.mixin({add:r(e),sub:r(i),mul:r(o),div:r(c),mod:a,inc:f,dec:l,neg:s,eq:t(w),seq:t(A),neq:u(t(w)),sneq:u(t(A)),not:b,gt:t(x),lt:t(k),gte:t(_),lte:t(q),bitwiseAnd:r(p),bitwiseOr:r(v),bitwiseXor:r(m),bitwiseNot:d,bitwiseLeft:r(h),bitwiseRight:r(g),bitwiseZ:r(y)})}(this),function(n){var r=n._||require("underscore");r.mixin({explode:function(n){return n.split("")},implode:function(n){return n.join("")},camelCase:function(n){return n.replace(/-([a-z])/g,function(n){return n[1].toUpperCase()})},toDash:function(n){return n=n.replace(/([A-Z])/g,function(n){return"-"+n.toLowerCase()}),"-"==n.charAt(0)?n.substr(1):n},strContains:function(n,r){if("string"!=typeof n)throw new TypeError;return-1!=n.indexOf(r)}})}(this),function(n){var r=n._||require("underscore");r.mixin({done:function(n){var t=r(n);return t.stopTrampoline=!0,t},trampoline:function(n){for(var t=n.apply(n,r.rest(arguments));r.isFunction(t)&&(t=t(),!(t instanceof r&&t.stopTrampoline)););return t.value()}})}(this);