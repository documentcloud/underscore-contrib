// underscore-contrib v0.3.0
// =========================

// > https://github.com/documentcloud/underscore-contrib
// > (c) 2013 Michael Fogus, DocumentCloud and Investigative Reporters & Editors
// > underscore-contrib may be freely distributed under the MIT license.

(function(){"object"==typeof exports&&(_=module.exports=require("underscore"));var n=Array.prototype.slice,r=function(n){return null!=n};_.mixin({cat:function(){return _.flatten(arguments,!0)},cons:function(n,r){return _.cat([n],r)},chunk:function(n,r,t){var e=function(n){if(null==n)return[];var u=_.take(n,r);return r===_.size(u)?_.cons(u,e(_.drop(n,r))):t?[_.take(_.cat(u,t),r)]:[]};return e(n)},chunkAll:function(n,r,t){t=null!=t?t:r;var e=function(n,r,t){return _.isEmpty(n)?[]:_.cons(_.take(n,r),e(_.drop(n,t),r,t))};return e(n,r,t)},mapcat:function(n,r){return _.flatten(_.map(n,r),!0)},interpose:function(r,t){if(!_.isArray(r))throw new TypeError;var e=_.size(r);return 0===e?r:1===e?r:n.call(_.mapcat(r,function(n){return _.cons(n,[t])}),0,-1)},weave:function(){return _.some(arguments)?1==arguments.length?arguments[0]:_.filter(_.flatten(_.zip.apply(null,arguments),!0),function(n){return null!=n}):[]},interleave:_.weave,repeat:function(n,r){return _.times(n,function(){return r})},cycle:function(n,r){return _.flatten(_.times(n,function(){return r}),!0)},splitAt:function(n,r){return[_.take(n,r),_.drop(n,r)]},iterateUntil:function(n,r,t){for(var e=[],u=n(t);r(u);)e.push(u),u=n(u);return e},takeSkipping:function(n,r){var t=[],e=_.size(n);if(0>=r)return[];if(1===r)return n;for(var u=0;e>u;u+=r)t.push(n[u]);return t},reductions:function(n,r,t){var e=[],u=t;return _.each(n,function(t,i){u=r(u,n[i]),e.push(u)}),e},keepIndexed:function(n,t){return _.filter(_.map(_.range(_.size(n)),function(r){return t(r,n[r])}),r)},reverseOrder:function(r){if("string"==typeof r)throw new TypeError("Strings cannot be reversed by _.reverseOrder");return n.call(r).reverse()},combinations:function(){return _.reduce(n.call(arguments,1),function(n,r){return _.reduce(n,function(n,t){return n.concat(_.map(r,function(n){return t.concat([n])}))},[])},_.map(arguments[0],function(n){return[n]}))}})}).call(this),function(){"object"==typeof exports&&(_=module.exports=require("underscore"));var n=Array.prototype.slice,r=Array.prototype.concat,t=function(n){return null!=n},e=function(n){return n!==!1&&t(n)},u=function(n){return _.isArray(n)||_.isArguments(n)};_.mixin({second:function(r,t,e){return null==r?void 0:null==t||e?r[1]:n.call(r,1,t)},third:function(r,t,e){return null==r?void 0:null==t||e?r[2]:n.call(r,2,t)},nth:function(n,r,t){return null==r||t?void 0:n[r]},nths:nths=function(r,t){return null==r?void 0:u(t)?_(t).map(function(n){return r[n]}):nths(r,n.call(arguments,1))},valuesAt:nths,binPick:function i(r,t){return null==r?void 0:u(t)?_.nths(r,_.range(t.length).filter(function(n){return t[n]})):i(r,n.call(arguments,1))},takeWhile:function(n,r){if(!u(n))throw new TypeError;for(var t=_.size(n),i=0;t>i&&e(r(n[i]));i++);return _.take(n,i)},dropWhile:function(n,r){if(!u(n))throw new TypeError;for(var t=_.size(n),i=0;t>i&&e(r(n[i]));i++);return _.drop(n,i)},splitWith:function(n,r){return[_.takeWhile(n,r),_.dropWhile(n,r)]},partitionBy:function(n,e){if(_.isEmpty(n)||!t(n))return[];var u=_.first(n),i=e(u),o=r.call([u],_.takeWhile(_.rest(n),function(n){return _.isEqual(i,e(n))}));return r.call([o],_.partitionBy(_.drop(n,_.size(o)),e))},best:function(n,r){return _.reduce(n,function(n,t){return r(n,t)?n:t})},keep:function(n,r){if(!u(n))throw new TypeError("expected an array as the first argument");return _.filter(_.map(n,function(n){return r(n)}),t)}})}.call(this),function(){function n(n){return _.isElement(n)?n.children:n}function r(n,r,t,o,c,a){var f=[];return function l(n,s,p){if(_.isObject(n)){if(f.indexOf(n)>=0)throw new TypeError(i);f.push(n)}if(t){var m=t.call(c,n,s,p);if(m===u)return u;if(m===e)return}var h,g=r(n);if(_.isObject(g)&&!_.isEmpty(g)){a&&(h=_.isArray(n)?[]:{});var y=_.any(g,function(r,t){var e=l(r,t,n);return e===u?!0:(h&&(h[t]=e),void 0)});if(y)return u}return o?o.call(c,n,s,p,h):void 0}(n)}function t(n,r,t){var u=[];return this.preorder(n,function(n,i){return t||i!=r?(_.has(n,r)&&(u[u.length]=n[r]),void 0):e}),u}"object"==typeof o&&(_=module.exports=require("underscore"));var e={},u={},i="Not a tree: same object found in two different branches",o={find:function(n,r,t){var e;return this.preorder(n,function(n,i,o){return r.call(t,n,i,o)?(e=n,u):void 0},t),e},filter:function(n,r,t,e){var u=[];return null==n?u:(r(n,function(n,r,i){t.call(e,n,r,i)&&u.push(n)},null,this._traversalStrategy),u)},reject:function(n,r,t,e){return this.filter(n,r,function(n,r,u){return!t.call(e,n,r,u)})},map:function(n,r,t,e){var u=[];return r(n,function(n,r,i){u[u.length]=t.call(e,n,r,i)},null,this._traversalStrategy),u},pluck:function(n,r){return t.call(this,n,r,!1)},pluckRec:function(n,r){return t.call(this,n,r,!0)},postorder:function(n,t,e,u){u=u||this._traversalStrategy,r(n,u,null,t,e)},preorder:function(n,t,e,u){u=u||this._traversalStrategy,r(n,u,t,null,e)},reduce:function(n,t,e,u){var i=function(n,r,u,i){return t(i||e,n,r,u)};return r(n,this._traversalStrategy,null,i,u,!0)}};o.collect=o.map,o.detect=o.find,o.select=o.filter,_.walk=function(r){var t=_.clone(o);return _.bindAll.apply(null,[t].concat(_.keys(t))),t._traversalStrategy=r||n,t},_.extend(_.walk,_.walk())}.call(this),function(){function n(n){return function(){if(1===arguments.length)return n.apply(this,arguments);throw new RangeError("Only a single argument may be accepted.")}}"object"==typeof exports&&(_=module.exports=require("underscore"));var r=function(){function r(t,e,u,i,o,c){return c===!0?i.unshift(o):i.push(o),i.length==u?t.apply(e,i):n(function(){return r(t,e,u,i.slice(0),arguments[0],c)})}return function(t,e){var u=this;return n(function(){return r(t,u,t.length,[],arguments[0],e)})}}(),t=function(){var n=[];return function(r){if("function"!=typeof r)throw Error("Argument 1 must be a function.");var t=r.length;return void 0===n[t]&&(n[t]=function(n){return function(){if(arguments.length!==t)throw new RangeError(t+" arguments must be applied.");return n.apply(this,arguments)}}),n[t](r)}}(),e=function(n){return r.call(this,n,!0)},u=function(r){return n(function(t){return n(function(n){return r.call(this,n,t)})})},i=function(r){return n(function(t){return n(function(e){return n(function(n){return r.call(this,n,e,t)})})})};_.mixin({fix:function(n){var r=_.rest(arguments),t=function(){for(var t=r.slice(),e=0,u=0;(t.length||arguments.length>e)>u;u++)t[u]===_&&(t[u]=arguments[e++]);return n.apply(null,t)};return t._original=n,t},unary:function(n){return function(r){return n.call(this,r)}},binary:function(n){return function(r,t){return n.call(this,r,t)}},ternary:function(n){return function(r,t,e){return n.call(this,r,t,e)}},quaternary:function(n){return function(r,t,e,u){return n.call(this,r,t,e,u)}},curry:r,curryRight:e,rCurry:e,curry2:function(r){return n(function(t){return n(function(n){return r.call(this,t,n)})})},curry3:function(r){return n(function(t){return n(function(e){return n(function(n){return r.call(this,t,e,n)})})})},curryRight2:u,rcurry2:u,curryRight3:i,rcurry3:i,enforce:t}),_.arity=function(){var n={};return function r(t,e){if(null==n[t]){for(var u=Array(t),i=0;t>i;++i)u[i]="__"+i;var o=u.join(),c="return function ("+o+") { return fun.apply(this, arguments); };";n[t]=Function(["fun"],c)}return null==e?function(n){return r(t,n)}:n[t](e)}}()}.call(this),function(){function n(n,r){return _.arity(n.length,function(){return n.apply(this,i.call(arguments,r))})}"object"==typeof exports&&(_=module.exports=require("underscore"));var r=function(n){return null!=n},t=function(n){return n!==!1&&r(n)},e=[].reverse,u=[].slice,i=[].map,o=function(n){return function(r,t){return 1===arguments.length?function(t){return n(r,t)}:n(r,t)}},c=function(n){var r=_(arguments).tail();return function(t){var e=_(t).cat();return _[n](e,function(t){return _[n](r,function(n){return n(t)})})}};_.mixin({always:_.constant,pipeline:function(){var n=_.isArray(arguments[0])?arguments[0]:arguments;return function(r){return _.reduce(n,function(n,r){return r(n)},r)}},conjoin:_.partial(c,"every"),disjoin:_.partial(c,"some"),comparator:function(n){return function(r,e){return t(n(r,e))?-1:t(n(e,r))?1:0}},complement:function(n){return function(){return!n.apply(this,arguments)}},splat:function(n){return function(r){return n.apply(this,r)}},unsplat:function(n){var r=n.length;return 1>r?n:1===r?function(){return n.call(this,u.call(arguments,0))}:function(){var t=arguments.length,e=u.call(arguments,0,r-1),i=Math.max(r-t-1,0),o=Array(i),c=u.call(arguments,n.length-1);return n.apply(this,e.concat(o).concat([c]))}},unsplatl:function(n){var r=n.length;return 1>r?n:1===r?function(){return n.call(this,u.call(arguments,0))}:function(){var t=arguments.length,e=u.call(arguments,Math.max(t-r+1,0)),i=u.call(arguments,0,Math.max(t-r+1,0));return n.apply(this,[i].concat(e))}},mapArgs:o(n),juxt:function(){var n=arguments;return function(){var r=arguments;return _.map(n,function(n){return n.apply(this,r)},this)}},fnull:function(n){var t=_.rest(arguments);return function(){for(var e=_.toArray(arguments),u=_.size(t),i=0;u>i;i++)r(e[i])||(e[i]=t[i]);return n.apply(this,e)}},flip2:function(n){return function(){var r=u.call(arguments);return r[0]=arguments[1],r[1]=arguments[0],n.apply(this,r)}},flip:function(n){return function(){var r=e.call(arguments);return n.apply(this,r)}},functionalize:function(n){return function(r){return n.apply(r,_.rest(arguments))}},methodize:function(n){return function(){return n.apply(null,_.cons(this,arguments))}},k:_.always,t:_.pipeline}),_.unsplatr=_.unsplat,_.mapArgsWith=o(_.flip(n)),_.bound=function(n,r){var t=n[r];if(!_.isFunction(t))throw new TypeError("Expected property to be a function");return _.bind(t,n)}}.call(this),function(){"object"==typeof exports&&(_=module.exports=require("underscore"));var n=Array.prototype.slice;_.mixin({attempt:function(r,t){if(null==r)return void 0;var e=r[t],u=n.call(arguments,2);return _.isFunction(e)?e.apply(r,u):void 0}})}.call(this),function(){function n(n){return function(r){return n.call(this,r)}}function r(n,r,t){var e,u;for(e=void 0!==t?t:n(),u=n();null!=u;)e=r.call(u,e,u),u=n();return e}function t(n,r){var t=w;return function(){return t===w?t=n:null!=t&&(t=r.call(t,t)),t}}function e(n,r){var t,e,u=n;return function(){return null!=u?(t=r.call(u,u),e=t[1],u=null!=e?t[0]:void 0,e):void 0}}function u(n,r,t){var e=t;return function(){var t=n();return null==t?t:e=void 0===e?t:r.call(t,e,t)}}function i(n,r,t){var e,u,i=t;return function(){return u=n(),null==u?u:void 0===i?i=u:(e=r.call(u,i,u),i=e[0],e[1])}}function o(n,r){return function(){var t;return t=n(),null!=t?r.call(t,t):void 0}}function c(n,r){var t=null;return function(){var e,u;if(null==t){if(u=n(),null==u)return t=null,void 0;t=r.call(u,u)}for(;null==e;)if(e=t(),null==e){if(u=n(),null==u)return t=null,void 0;t=r.call(u,u)}return e}}function a(n,r){return function(){var t;for(t=n();null!=t;){if(r.call(t,t))return t;t=n()}return void 0}}function f(n,r){return a(n,function(n){return!r(n)})}function l(n,r){return a(n,r)()}function s(n,r,t){for(var e=0;r-->0;)n();return null!=t?function(){return t>=++e?n():void 0}:n}function p(n,r){return s(n,null==r?1:r)}function m(n,r){return s(n,0,null==r?1:r)}function h(n){var r=0;return function(){return n[r++]}}function g(n){var r=0,t=n.length;return function(){return n[r++%t]}}function y(n){var r,t,e;return r=0,e=[],t=function(){var u,i;return u=n[r++],u instanceof Array?(e.push({array:n,index:r}),n=u,r=0,t()):void 0===u?e.length>0?(i=e.pop(),n=i.array,r=i.index,t()):void 0:u}}function v(n){return function(){return n}}function d(n,r,t){return function(){var e;return n>r?void 0:(e=n,n+=t,e)}}function x(n,r,t){return function(){var e;return r>n?void 0:(e=n,n-=t,e)}}function b(n,r,t){return null==n?d(1,1/0,1):null==r?d(n,1/0,1):null==t?r>=n?d(n,r,1):x(n,r,1):t>0?d(n,r,t):0>t?x(n,r,Math.abs(t)):k(n)}"object"==typeof exports&&(_=module.exports=require("underscore"));var w={},A=n(b);_.iterators={accumulate:u,accumulateWithReturn:i,foldl:r,reduce:r,unfold:t,unfoldWithReturn:e,map:o,mapcat:c,select:a,reject:f,filter:a,find:l,slice:s,drop:p,take:m,List:h,Tree:y,constant:v,K:v,numbers:A,range:b,cycle:g}}.call(this,void 0),"object"==typeof exports&&(_=module.exports=require("underscore")),_.mixin({isInstanceOf:function(n,r){return n instanceof r},isAssociative:function(n){return _.isArray(n)||_.isObject(n)||_.isArguments(n)},isIndexed:function(n){return _.isArray(n)||_.isString(n)||_.isArguments(n)},isSequential:function(n){return _.isArray(n)||_.isArguments(n)},isPlainObject:function(n){return _.isObject(n)&&n.constructor===Object},isZero:function(n){return 0===n},isEven:function(n){return _.isFinite(n)&&0===(1&n)},isOdd:function(n){return _.isFinite(n)&&!_.isEven(n)},isPositive:function(n){return n>0},isNegative:function(n){return 0>n},isValidDate:function(n){return _.isDate(n)&&!_.isNaN(n.getTime())},isNumeric:function(n){return!isNaN(parseFloat(n))&&isFinite(n)},isInteger:function(n){return _.isNumeric(n)&&0===n%1},isFloat:function(n){return _.isNumeric(n)&&!_.isInteger(n)},isJSON:function(n){try{JSON.parse(n)}catch(r){return!1}return!0},isIncreasing:function(){var n=_.size(arguments);if(1===n)return!0;if(2===n)return arguments[0]<arguments[1];for(var r=1;n>r;r++)if(arguments[r-1]>=arguments[r])return!1;return!0},isDecreasing:function(){var n=_.size(arguments);if(1===n)return!0;if(2===n)return arguments[0]>arguments[1];for(var r=1;n>r;r++)if(arguments[r-1]<=arguments[r])return!1;return!0}}),function(){"object"==typeof exports&&(_=module.exports=require("underscore"));var n=(Array.prototype.slice,Array.prototype.concat),r=function(n){return null!=n},t=function(n){return n!==!1&&r(n)},e=function(n){return _.isArray(n)||_.isObject(n)},u=function(n){return function(r){return function(t){return n(t,r)}}};_.mixin({merge:function(){var r=_.some(arguments)?{}:null;return t(r)&&_.extend.apply(null,n.call([r],_.toArray(arguments))),r},renameKeys:function(t,e){return _.reduce(e,function(n,e,u){return r(t[u])?(n[e]=t[u],n):n},_.omit.apply(null,n.call([t],_.keys(e))))},snapshot:function(n){if(null==n||"object"!=typeof n)return n;var r=new n.constructor;for(var t in n)n.hasOwnProperty(t)&&(r[t]=_.snapshot(n[t]));return r},updatePath:function(n,t,u,i){if(!e(n))throw new TypeError("Attempted to update a non-associative object.");if(!r(u))return t(n);var o=_.isArray(u),c=o?u:[u],a=o?_.snapshot(n):_.clone(n),f=_.last(c),l=a;return _.each(_.initial(c),function(n){i&&!_.has(l,n)&&(l[n]=_.clone(i)),l=l[n]}),l[f]=t(l[f]),a},setPath:function(n,t,e,u){if(!r(e))throw new TypeError("Attempted to set a property at a null path.");return _.updatePath(n,function(){return t},e,u)},frequencies:u(_.countBy)(_.identity)})}.call(this),function(){function n(n){for(var r,t=/\[("|')(.+)\1\]|([^.\[\]]+)/g,e=[];null!==(r=t.exec(n));)e.push(r[2]||r[3]);return e}"object"==typeof exports&&(_=module.exports=require("underscore"));var r=Array.prototype.concat,t=Array.prototype;t.slice,_.mixin({accessor:function(n){return function(r){return r&&r[n]}},dictionary:function(n){return function(r){return n&&r&&n[r]}},selectKeys:function(n,t){return _.pick.apply(null,r.call([n],t))},kv:function(n,r){return _.has(n,r)?[r,n[r]]:void 0},getPath:function(r,t){t="string"==typeof t?n(t):t;for(var e=-1,u=t.length;u>++e&&null!=r;)r=r[t[e]];return e===u?r:void 0},hasPath:function(r,t){t="string"==typeof t?n(t):t;for(var e=-1,u=t.length;u>++e&&_.isObject(r);){if(!(t[e]in r))return!1;r=r[t[e]]}return e===u},keysFromPath:n,pickWhen:function(n,r){var t={};return _.each(n,function(e,u){r(n[u])&&(t[u]=n[u])}),t},omitWhen:function(n,r){return _.pickWhen(n,function(n){return!r(n)})}})}.call(this),"object"==typeof exports&&(_=module.exports=require("underscore")),_.mixin({exists:function(n){return null!=n},truthy:function(n){return n!==!1&&_.exists(n)},falsey:function(n){return!_.truthy(n)},not:function(n){return!n},firstExisting:function(){for(var n=0;arguments.length>n;n++)if(null!=arguments[n])return arguments[n]}}),function(){function n(n){return t(function(r){return _.reduce(r,n)})}function r(n){return t(function(r){for(var t,e=0;r.length-1>e;e++)if(t=n(r[e],r[e+1]),t===!1)return t;return t})}function t(n){return function(r){var t=e(r)?r:arguments;return n(t)}}function e(n){return null!=n&&"number"==typeof n.length}function u(n){return function(){return!n.apply(this,arguments)}}function i(n,r){return n+r}function o(n,r){return n-r}function c(n,r){return n*r}function a(n,r){return n/r}function f(n,r){return n%r}function l(n){return++n}function s(n){return--n}function p(n){return-n}function m(n,r){return n&r}function h(n,r){return n|r}function g(n,r){return n^r}function y(n,r){return n<<r}function v(n,r){return n>>r}function d(n,r){return n>>>r}function x(n){return~n}function b(n,r){return n==r}function w(n,r){return n===r}function A(n){return!n}function j(n,r){return n>r}function k(n,r){return r>n}function E(n,r){return n>=r}function q(n,r){return r>=n}"object"==typeof exports&&(_=module.exports=require("underscore")),_.mixin({add:n(i),sub:n(o),mul:n(c),div:n(a),mod:f,inc:l,dec:s,neg:p,eq:r(b),seq:r(w),neq:u(r(b)),sneq:u(r(w)),not:A,gt:r(j),lt:r(k),gte:r(E),lte:r(q),bitwiseAnd:n(m),bitwiseOr:n(h),bitwiseXor:n(g),bitwiseNot:x,bitwiseLeft:n(y),bitwiseRight:n(v),bitwiseZ:n(d)})}.call(this),function(){"object"==typeof exports&&(_=module.exports=require("underscore"));var n=/\+/g,r=/\%20/g,t=/(?:([^\[]+))|(?:\[(.*?)\])/g,e=function(r){return decodeURIComponent(r.replace(n,"%20"))},u=function(n){return encodeURIComponent(n).replace(r,"+")},i=function(n,r,t){return _.isUndefined(t)&&(t=!0),_.isArray(r)?_.map(r,function(r,e){return i(t?e:n+"[]",r,!1)}).join("&"):_.isObject(r)?_.map(r,function(r,e){return i(t?e:n+"["+e+"]",r,!1)}).join("&"):u(n)+"="+u(r)};_.mixin({explode:function(n){return n.split("")},fromQuery:function(n){var r,u,i,o,c,a=n.split("&"),f={};return _.each(a,function(n){for(n=n.split("="),r=e(n[0]),i=r,c=f,t.lastIndex=0;null!==(u=t.exec(r));)_.isUndefined(u[1])?(o=u[2],c[i]=c[i]||(o?{}:[]),c=c[i]):o=u[1],i=o||_.size(c);c[i]=e(n[1])}),f},implode:function(n){return n.join("")},camelCase:function(n,r){if(r=r||"-","string"!=typeof r)throw new TypeError("Separator must be a string.");if(1!=r.length)throw Error("Separator must be one character.");return n.replace(RegExp(r+"([a-z])","g"),function(n){return n[1].toUpperCase()})},toDash:function(n,r){if(r=r||"-","string"!=typeof r)throw new TypeError("Separator must be a string.");if(1!=r.length)throw Error("Separator must be one character.");return n=n.replace(/([A-Z])/g,function(n){return r+n.toLowerCase()}),n.charAt(0)==r?n.substr(1):n},toQuery:function(n){return i("",n)},strContains:function(n,r){if("string"!=typeof n)throw new TypeError;return-1!=n.indexOf(r)}})}.call(this),"object"==typeof exports&&(_=module.exports=require("underscore")),_.mixin({done:function(n){var r=_(n);return r.stopTrampoline=!0,r},trampoline:function(n){for(var r=n.apply(n,_.rest(arguments));_.isFunction(r)&&(r=r(),!(r instanceof _&&r.stopTrampoline)););return r.value()}});